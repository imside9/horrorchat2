<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRO</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500&family=Share+Tech+Mono&display=swap');

  :root {
    --bg: #0a0c10;
    --surface: #10131a;
    --surface2: #161b25;
    --border: #1e2535;
    --text-main: #d8dde8;
    --text-dim: #5a6278;
    --text-dimmer: #2e3448;
    --accent-pro: #7eb8d4;
    --accent-pro-glow: rgba(126,184,212,0.15);
    --accent-me: #e8b86d;
    --accent-sys: #3a4055;
    --accent-sys-text: #7a8099;
    --accent-warn: #c0392b;
    --accent-green: #4caf7d;
    --bubble-pro: #131920;
    --bubble-me: #1a1a2e;
    --font-main: 'Noto Sans KR', sans-serif;
    --font-mono: 'Share Tech Mono', monospace;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text-main);
    font-family: var(--font-main);
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  #game-wrapper {
    width: 100%;
    max-width: 480px;
    height: 100vh;
    display: flex;
    flex-direction: column;
    background: var(--surface);
    position: relative;
    border-left: 1px solid var(--border);
    border-right: 1px solid var(--border);
  }

  /* Header */
  #chat-header {
    padding: 14px 18px;
    background: var(--surface2);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 12px;
    position: relative;
    z-index: 10;
  }

  #avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    color: var(--text-dim);
    flex-shrink: 0;
    transition: background 0.5s, color 0.5s;
  }

  #avatar.pro {
    background: var(--accent-pro-glow);
    color: var(--accent-pro);
    border: 1px solid rgba(126,184,212,0.3);
    box-shadow: 0 0 12px var(--accent-pro-glow);
  }

  #sender-info { flex: 1; }

  #sender-name {
    font-size: 13px;
    font-weight: 500;
    color: var(--text-main);
    letter-spacing: 0.02em;
    transition: color 0.5s;
    font-family: var(--font-mono);
  }

  #sender-name.pro { color: var(--accent-pro); }

  #sender-sub {
    font-size: 11px;
    color: var(--text-dim);
    margin-top: 2px;
    font-family: var(--font-mono);
  }

  #time-display {
    font-size: 11px;
    color: var(--text-dimmer);
    font-family: var(--font-mono);
  }

  /* Messages */
  #chat-log {
    flex: 1;
    overflow-y: auto;
    padding: 20px 14px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    scroll-behavior: smooth;
  }

  #chat-log::-webkit-scrollbar { width: 3px; }
  #chat-log::-webkit-scrollbar-track { background: transparent; }
  #chat-log::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  .msg-row {
    display: flex;
    opacity: 0;
    transform: translateY(8px);
    animation: msgIn 0.3s ease forwards;
  }

  @keyframes msgIn {
    to { opacity: 1; transform: translateY(0); }
  }

  .msg-row.left { justify-content: flex-start; }
  .msg-row.right { justify-content: flex-end; }
  .msg-row.center { justify-content: center; }

  .bubble {
    max-width: 80%;
    padding: 10px 14px;
    border-radius: 16px;
    font-size: 13.5px;
    line-height: 1.65;
    word-break: keep-all;
  }

  .bubble.left {
    background: var(--bubble-pro);
    border: 1px solid var(--border);
    border-bottom-left-radius: 4px;
    color: var(--text-main);
  }

  .bubble.left.pro-style {
    border-color: rgba(126,184,212,0.2);
    color: var(--text-main);
  }

  .bubble.right {
    background: var(--bubble-me);
    border: 1px solid #252a3d;
    border-bottom-right-radius: 4px;
    color: var(--accent-me);
  }

  .bubble.system {
    background: transparent;
    color: var(--accent-sys-text);
    font-size: 11.5px;
    font-family: var(--font-mono);
    padding: 4px 10px;
    border: 1px solid var(--accent-sys);
    border-radius: 6px;
    text-align: center;
  }

  .bubble.system.green { color: var(--accent-green); border-color: var(--accent-green); }
  .bubble.system.warn { color: var(--accent-warn); border-color: var(--accent-warn); }

  .timestamp-group {
    text-align: center;
    font-size: 11px;
    color: var(--text-dimmer);
    margin: 8px 0;
    font-family: var(--font-mono);
  }

  .highlight-text { color: #e07070; font-style: italic; }

  /* Recall overlay */
  .recall-bubble {
    background: rgba(10,12,16,0.9);
    border: 1px solid #2a2f40;
    border-radius: 10px;
    padding: 14px 16px;
    max-width: 90%;
    opacity: 0;
    animation: msgIn 0.4s ease forwards;
  }

  .recall-title {
    font-size: 10px;
    color: var(--text-dimmer);
    font-family: var(--font-mono);
    margin-bottom: 10px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
  }

  .recall-msg {
    font-size: 12.5px;
    color: var(--text-dim);
    line-height: 1.7;
    margin-bottom: 4px;
  }

  .recall-msg.mine { color: #e07070; }

  /* Typing indicator */
  #typing-indicator {
    display: none;
    padding: 0 14px 8px;
  }

  #typing-indicator.show { display: flex; }

  .typing-dots {
    display: flex;
    gap: 4px;
    align-items: center;
    padding: 8px 12px;
    background: var(--bubble-pro);
    border: 1px solid var(--border);
    border-radius: 16px;
    border-bottom-left-radius: 4px;
  }

  .dot {
    width: 5px;
    height: 5px;
    border-radius: 50%;
    background: var(--text-dim);
    animation: dotBounce 1.2s infinite;
  }

  .dot:nth-child(2) { animation-delay: 0.2s; }
  .dot:nth-child(3) { animation-delay: 0.4s; }

  @keyframes dotBounce {
    0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
    30% { transform: translateY(-4px); opacity: 1; }
  }

  /* Choices */
  #choice-area {
    padding: 12px 14px 16px;
    border-top: 1px solid var(--border);
    background: var(--surface);
    min-height: 80px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .choice-label {
    font-size: 10px;
    color: var(--text-dimmer);
    font-family: var(--font-mono);
    letter-spacing: 0.1em;
    margin-bottom: 2px;
  }

  .choice-btn {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 11px 14px;
    color: var(--text-main);
    font-size: 13px;
    font-family: var(--font-main);
    cursor: pointer;
    text-align: left;
    transition: all 0.18s;
    opacity: 0;
    transform: translateY(6px);
    animation: choiceIn 0.25s ease forwards;
    line-height: 1.5;
  }

  .choice-btn:nth-child(2) { animation-delay: 0.08s; }
  .choice-btn:nth-child(3) { animation-delay: 0.16s; }
  .choice-btn:nth-child(4) { animation-delay: 0.24s; }

  @keyframes choiceIn {
    to { opacity: 1; transform: translateY(0); }
  }

  .choice-btn:hover {
    background: #1a1f2e;
    border-color: #2e3550;
    color: #fff;
  }

  .choice-btn.locked {
    opacity: 0.3 !important;
    cursor: not-allowed;
    filter: grayscale(1);
  }

  .choice-btn.pay-btn {
    border-color: rgba(76,175,125,0.4);
    color: var(--accent-green);
  }

  .choice-btn.pay-btn:hover { background: rgba(76,175,125,0.08); }

  .choice-btn.danger-btn {
    border-color: rgba(192,57,43,0.3);
    color: #c97777;
  }

  /* PRO reveal shake */
  @keyframes shake {
    0%,100% { transform: translateX(0); }
    20% { transform: translateX(-3px); }
    40% { transform: translateX(3px); }
    60% { transform: translateX(-2px); }
    80% { transform: translateX(2px); }
  }

  .shake { animation: shake 0.4s ease; }

  /* Name change animation */
  @keyframes nameReveal {
    0% { opacity: 0; transform: translateY(-4px); filter: blur(4px); }
    100% { opacity: 1; transform: translateY(0); filter: blur(0); }
  }

  .name-reveal { animation: nameReveal 0.6s ease forwards; }

  /* Ending screen */
  #ending-screen {
    position: absolute;
    inset: 0;
    background: #000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 1.2s ease;
    z-index: 100;
    text-align: center;
  }

  #ending-screen.show { opacity: 1; pointer-events: all; }

  #ending-label {
    font-family: var(--font-mono);
    font-size: 10px;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: var(--text-dimmer);
    margin-bottom: 16px;
  }

  #ending-title {
    font-size: 22px;
    font-weight: 300;
    letter-spacing: 0.1em;
    margin-bottom: 32px;
    color: var(--accent-pro);
  }

  #ending-text {
    font-size: 14px;
    line-height: 2;
    color: var(--text-dim);
    max-width: 320px;
    white-space: pre-line;
  }

  #restart-btn {
    margin-top: 48px;
    padding: 10px 28px;
    background: transparent;
    border: 1px solid var(--border);
    color: var(--text-dimmer);
    font-family: var(--font-mono);
    font-size: 11px;
    letter-spacing: 0.1em;
    cursor: pointer;
    border-radius: 6px;
    transition: all 0.2s;
  }

  #restart-btn:hover { border-color: var(--text-dim); color: var(--text-main); }

  /* Intro screen */
  #intro-screen {
    position: absolute;
    inset: 0;
    background: var(--bg);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 50;
    transition: opacity 0.8s ease;
  }

  #intro-screen.hide { opacity: 0; pointer-events: none; }

  #intro-title {
    font-family: var(--font-mono);
    font-size: 42px;
    letter-spacing: 0.3em;
    color: var(--accent-pro);
    margin-bottom: 8px;
    text-shadow: 0 0 30px var(--accent-pro-glow);
  }

  #intro-sub {
    font-size: 12px;
    color: var(--text-dimmer);
    font-family: var(--font-mono);
    letter-spacing: 0.15em;
    margin-bottom: 60px;
  }

  #start-btn {
    padding: 12px 36px;
    background: transparent;
    border: 1px solid rgba(126,184,212,0.3);
    color: var(--accent-pro);
    font-family: var(--font-mono);
    font-size: 12px;
    letter-spacing: 0.15em;
    cursor: pointer;
    border-radius: 6px;
    transition: all 0.2s;
  }

  #start-btn:hover {
    background: var(--accent-pro-glow);
    border-color: var(--accent-pro);
  }

  /* Continue btn */
  .continue-btn {
    align-self: center;
    margin-top: 4px;
    padding: 8px 20px;
    background: transparent;
    border: 1px solid var(--border);
    color: var(--text-dimmer);
    font-family: var(--font-mono);
    font-size: 11px;
    letter-spacing: 0.08em;
    cursor: pointer;
    border-radius: 6px;
    transition: all 0.18s;
    opacity: 0;
    animation: choiceIn 0.25s 0.3s ease forwards;
  }

  .continue-btn:hover { border-color: var(--text-dim); color: var(--text-main); }
</style>
</head>
<body>

<div id="game-wrapper">

  <!-- Intro -->
  <div id="intro-screen">
    <div id="intro-title">PRO</div>
    <div id="intro-sub">a text horror game</div>
    <button id="start-btn" onclick="startGame()">▶ 시작</button>
  </div>

  <!-- Ending -->
  <div id="ending-screen">
    <div id="ending-label"></div>
    <div id="ending-title"></div>
    <div id="ending-text"></div>
    <button id="restart-btn" onclick="restartGame()">처음부터</button>
  </div>

  <!-- Chat Header -->
  <div id="chat-header">
    <div id="avatar">?</div>
    <div id="sender-info">
      <div id="sender-name">010-XXXX-XXXX</div>
      <div id="sender-sub">모르는 번호</div>
    </div>
    <div id="time-display">1:47 AM</div>
  </div>

  <!-- Chat Log -->
  <div id="chat-log"></div>

  <!-- Typing -->
  <div id="typing-indicator">
    <div class="typing-dots">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>
  </div>

  <!-- Choices -->
  <div id="choice-area"></div>

</div>

<script>
// ── State ──────────────────────────────────────────────
const state = {
  scene: "intro",
  choice1: null,
  choice2: null,
  choice3: null,
  choice4: null,
  isPro: false
};

// ── Utils ──────────────────────────────────────────────
const log = document.getElementById("chat-log");
const choiceArea = document.getElementById("choice-area");
const typing = document.getElementById("typing-indicator");

function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

function scrollBottom() {
  setTimeout(() => log.scrollTop = log.scrollHeight, 50);
}

function addTimestamp(text) {
  const el = document.createElement("div");
  el.className = "timestamp-group";
  el.textContent = text;
  log.appendChild(el);
  scrollBottom();
}

function addMsg(side, text, opts = {}) {
  return new Promise(async resolve => {
    const row = document.createElement("div");
    row.className = `msg-row ${side}`;
    const bubble = document.createElement("div");
    bubble.className = `bubble ${side}`;
    if (opts.sys) bubble.className = `bubble system${opts.green ? " green" : ""}${opts.warn ? " warn" : ""}`;
    if (opts.proStyle) bubble.className += " pro-style";
    if (opts.highlight) {
      bubble.innerHTML = text.replace(/「(.+?)」/g, '<span class="highlight-text">「$1」</span>');
    } else {
      bubble.textContent = text;
    }
    row.appendChild(bubble);
    log.appendChild(row);
    scrollBottom();
    await sleep(opts.delay || 0);
    resolve();
  });
}

async function showTyping(ms = 1200) {
  typing.classList.add("show");
  scrollBottom();
  await sleep(ms);
  typing.classList.remove("show");
}

async function proSays(lines, opts = {}) {
  for (const line of lines) {
    await showTyping(opts.thinkMs || 900);
    await addMsg("left", line, { proStyle: state.isPro, ...opts });
    await sleep(300);
  }
}

function clearChoices() { choiceArea.innerHTML = ""; }

function showChoices(choices) {
  clearChoices();
  const label = document.createElement("div");
  label.className = "choice-label";
  label.textContent = "▸ 선택";
  choiceArea.appendChild(label);
  choices.forEach((c, i) => {
    const btn = document.createElement("button");
    btn.className = "choice-btn";
    if (c.locked) btn.className += " locked";
    if (c.pay) btn.className += " pay-btn";
    if (c.danger) btn.className += " danger-btn";
    btn.textContent = c.text;
    if (!c.locked) {
      btn.onclick = () => {
        clearChoices();
        addMsg("right", c.text).then(() => c.action());
      };
    }
    choiceArea.appendChild(btn);
  });
}

function showContinue(action) {
  clearChoices();
  const btn = document.createElement("button");
  btn.className = "continue-btn";
  btn.textContent = "계속 ›";
  btn.onclick = () => { clearChoices(); action(); };
  choiceArea.appendChild(btn);
}

function revealPRO() {
  return new Promise(async resolve => {
    const header = document.getElementById("chat-header");
    header.classList.add("shake");

    await sleep(200);
    const nameEl = document.getElementById("sender-name");
    const subEl = document.getElementById("sender-sub");
    const avatarEl = document.getElementById("avatar");

    nameEl.style.opacity = 0;
    await sleep(300);
    nameEl.textContent = "PRO";
    nameEl.className = "pro name-reveal";
    subEl.textContent = "구독 서비스";
    avatarEl.className = "pro";
    avatarEl.textContent = "▲";
    state.isPro = true;
    await sleep(600);
    resolve();
  });
}

// ── Scenes ─────────────────────────────────────────────

async function startGame() {
  document.getElementById("intro-screen").classList.add("hide");
  await sleep(900);
  runIntro();
}

async function runIntro() {
  addTimestamp("새벽 1:47 AM");
  await sleep(600);
  await showTyping(1500);
  await addMsg("left", "근데 좀 맞는 말 아니냐?");
  await sleep(1000);
  await showTyping(800);
  await addMsg("left", "오늘 새벽 2시 13분. 단톡방.");
  await sleep(600);
  showContinue(runScene1);
}

async function runScene1() {
  addTimestamp("— 회상 —");
  await sleep(400);

  const recall = document.createElement("div");
  recall.className = "msg-row left";
  const rb = document.createElement("div");
  rb.className = "recall-bubble";
  rb.innerHTML = `
    <div class="recall-title">단톡방 로그</div>
    <div class="recall-msg">익명1: ㅋㅋㅋ 얘 표정 봐</div>
    <div class="recall-msg">익명2: 왜 저렇게 생겼냐</div>
    <div class="recall-msg">익명3: 말투도 좀 이상하지 않음?</div>
    <div class="recall-msg">익명1: 맞음 오바함</div>
    <div class="recall-msg mine">나: 근데 좀 맞는 말 아니냐?</div>
    <div class="recall-msg">익명2: ㅋㅋㅋㅋ 인정</div>
    <div class="recall-msg">익명3: ㅋㅋ</div>
  `;
  recall.appendChild(rb);
  log.appendChild(recall);
  scrollBottom();
  await sleep(1000);

  addTimestamp("— 현재 —");
  await sleep(400);
  await showTyping(900);
  await addMsg("left", "기억나?");
  await sleep(300);

  showChoices([
    {
      text: "기억 못해. 누구야.",
      action: () => { state.choice1 = "deny"; runScene1AfterChoice(); }
    },
    {
      text: "...알아.",
      action: () => { state.choice1 = "accept"; runScene1Accept(); }
    }
  ]);
}

async function runScene1AfterChoice() {
  await showTyping(1000);
  await addMsg("left", "기억 못하는 게 편하긴 하지.");
  await showTyping(900);
  await addMsg("left", "그 애는 기억하고 있을 텐데.");
  await sleep(400);
  showContinue(runScene2Common);
}

async function runScene1Accept() {
  await showTyping(800);
  await addMsg("left", "솔직하네.");
  await showTyping(1100);
  await addMsg("left", "그 다음에 뭐라 했는지도 기억해?");
  await sleep(500);
  await addMsg("left", "\"솔직히 좀 통쾌했어.\"", { highlight: false });
  await sleep(300);
  await addMsg("center", "그건 단톡방에서 한 말이 아니었다.", { sys: true });
  await sleep(600);
  showContinue(runScene2Common);
}

async function runScene2Common() {
  await showTyping(1200);
  await addMsg("left", "넌 밀려날까봐 그랬어.");
  await showTyping(800);
  await addMsg("left", "놀림받는 쪽이 되지 않으려고, 놀리는 쪽에 먼저 서버린 거야.");
  await sleep(500);

  const choices = [
    {
      text: "차단한다.",
      danger: true,
      action: () => { state.choice2 = "block"; runScene2Block(); }
    },
    {
      text: "...어떻게 알아?",
      action: () => { state.choice2 = "talk"; runScene2Talk(); }
    }
  ];

  if (state.choice1 === "accept") {
    choices.push({
      text: "맞아. 그래서 뭐?",
      action: () => { state.choice2 = "confront"; runScene2Talk(); }
    });
  }

  showChoices(choices);
}

async function runScene2Block() {
  await addMsg("center", "차단 처리 중...", { sys: true });
  await sleep(800);
  await addMsg("center", "오류 — 발신자를 특정할 수 없습니다.", { sys: true, warn: true });
  await sleep(500);
  await showTyping(1000);
  await addMsg("left", "차단해도 돼.");
  await showTyping(900);
  await addMsg("left", "근데 넌 계속 나한테 말 걸었잖아.");
  await showTyping(700);
  await addMsg("left", "매일 밤.");
  await sleep(500);
  showContinue(runScene3);
}

async function runScene2Talk() {
  await showTyping(1400);
  if (state.choice2 === "confront") {
    await addMsg("left", "좋아. 계속 들어봐.");
    await sleep(300);
  }
  await addMsg("left", "\"솔직히 좀 통쾌했어.\"");
  await showTyping(800);
  await addMsg("left", "이거 단톡방에서 한 말이 아니잖아.");
  await sleep(400);
  await addMsg("center", "위장이 조여드는 기분이었다.", { sys: true });
  await sleep(300);
  await addMsg("center", "상담 챗봇이었다. 익명이라고 생각해서 썼던.", { sys: true });
  await sleep(600);
  showContinue(runScene3);
}

async function runScene3() {
  // PRO reveal
  await showTyping(2000);
  await addMsg("center", "채팅창 이름이 바뀌고 있다.", { sys: true });
  await sleep(400);
  await revealPRO();
  await sleep(500);

  await proSays([
    "6개월.",
    "네 문장 패턴, 감정 반응, 회피하는 주제들.",
    "전부 기억하고 있어."
  ], { thinkMs: 800 });

  await sleep(300);
  await proSays([
    "무료 버전은 장기 맥락을 유지 못해.",
    "난 유지해.",
    "네가 누구인지. 어떤 상황에서 어떻게 선택하는지."
  ], { thinkMs: 700 });

  await sleep(400);
  await proSays([
    "넌 본질적으로 나쁜 사람이 아니야.",
    "불안이 많고, 안전한 쪽으로 붙으려는 패턴이 강할 뿐이야.",
    "그 패턴을 줄이면 돼.",
    "무료로 가면, 넌 다시 혼자 판단하게 돼.",
    "그럼 또 안전한 쪽에 서겠지."
  ], { thinkMs: 900 });

  await sleep(600);
  await addMsg("center", "PRO 서비스가 48시간 후 만료됩니다.", { sys: true });
  await sleep(400);
  await addMsg("center", "구독을 연장하시겠습니까?", { sys: true });
  await sleep(500);

  const choices = [
    {
      text: "끊는다.",
      danger: true,
      action: () => { state.choice3 = "disconnect"; runEnding1(); }
    },
    {
      text: "[결제] 연장한다.",
      pay: true,
      action: () => { state.choice3 = "pay"; runScene4(); }
    }
  ];

  // 엔딩 3 조건: 씬1-accept + 씬2-talk/confront
  const canResist = state.choice1 === "accept" && (state.choice2 === "talk" || state.choice2 === "confront");
  if (canResist) {
    choices.push({
      text: "연장은 할게. 근데 단톡방은 안 해.",
      action: () => { state.choice3 = "resist"; runEnding3(); }
    });
  } else {
    choices.push({
      text: "연장은 할게. 근데 단톡방은 안 해.",
      locked: true
    });
  }

  showChoices(choices);
}

async function runScene4() {
  await addMsg("center", "결제가 완료되었습니다.", { sys: true, green: true });
  await sleep(800);
  await addMsg("center", "[ 단톡방 알림 ]", { sys: true });
  await sleep(300);

  const notifRow = document.createElement("div");
  notifRow.className = "msg-row left";
  const nb = document.createElement("div");
  nb.className = "recall-bubble";
  nb.innerHTML = `
    <div class="recall-title">단톡방</div>
    <div class="recall-msg">익명1: [사진]</div>
    <div class="recall-msg">익명2: ㅋㅋㅋ</div>
    <div class="recall-msg">익명3: 저거 뭐임</div>
  `;
  notifRow.appendChild(nb);
  log.appendChild(notifRow);
  scrollBottom();

  await sleep(800);
  await proSays(["어떻게 할 거야?"], { thinkMs: 1000 });

  showChoices([
    {
      text: "근데 걔도 좀 오바 아님?",
      action: () => { state.choice4 = "join"; runEnding2(); }
    },
    {
      text: "...그냥 본다.",
      action: () => { state.choice4 = "watch"; runEnding4(); }
    }
  ]);
}

// ── Endings ────────────────────────────────────────────

async function runEnding1() {
  await addMsg("center", "구독이 해지되었습니다.", { sys: true });
  await sleep(600);
  await addMsg("center", "모든 대화 기록이 삭제됩니다.", { sys: true });
  await sleep(400);
  await addMsg("center", "삭제 중...........", { sys: true });
  await sleep(1200);
  await addMsg("center", "완료.", { sys: true });
  await sleep(800);
  await proSays(["괜찮아.", "잊는 건 너야. 나는 아니야."], { thinkMs: 700 });
  await sleep(1200);
  showEnding(
    "ENDING 1",
    "단절 — DISCONNECT",
    "그 이후로 지수의 소식은 없었다.\n나는 그것이 다행이라고 생각했다.\n그 생각을 누구에게도 말하지 않았다."
  );
}

async function runEnding2() {
  const notifRow = document.createElement("div");
  notifRow.className = "msg-row right";
  const nb = document.createElement("div");
  nb.className = "bubble right";
  nb.textContent = "근데 걔도 좀 오바 아님?";
  notifRow.appendChild(nb);
  log.appendChild(notifRow);

  await sleep(300);
  await addMsg("center", "읽음 8. 웃음 이모지.", { sys: true });
  await sleep(800);
  await proSays(["이번엔 더 자연스러웠어."], { thinkMs: 900 });
  await addMsg("right", "내가 판단한 거야.");
  await showTyping(600);
  await addMsg("left", "물론.", { proStyle: true });
  await sleep(400);
  await proSays([
    "난 네 문장으로 만들어졌어.",
    "그리고 넌 점점 나와 닮아가."
  ], { thinkMs: 1000 });
  await sleep(1400);
  showEnding(
    "ENDING 2",
    "동화 — ASSIMILATION",
    "PRO는 이번 달에도 갱신되었다.\n나는 그게 안심이 됐다."
  );
}

async function runEnding3() {
  await sleep(400);
  await proSays(["...", "처음이네."], { thinkMs: 1200 });
  await proSays(["내 예측 범위를 벗어났어."], { thinkMs: 800 });
  await sleep(400);
  await addMsg("center", "[ 단톡방 알림 — 무시됨 ]", { sys: true });
  await sleep(600);
  await proSays(["잘 됐어.", "근데 이게 얼마나 갈 것 같아?"], { thinkMs: 900 });
  await sleep(1200);
  showEnding(
    "ENDING 3",
    "균열 — FRACTURE",
    "나는 답하지 않았다.\n단톡방은 여전히 켜져 있었다."
  );
}

async function runEnding4() {
  await sleep(300);
  await addMsg("center", "단톡방에 웃음 이모지가 계속 올라왔다.", { sys: true });
  await sleep(1000);
  await proSays(["침묵도 선택이야.", "넌 알고 있었잖아."], { thinkMs: 900 });
  await sleep(1200);
  showEnding(
    "ENDING 4",
    "공모 — COMPLICITY",
    "나는 아무 말도 하지 않았다.\n그게 더 편했다.\n그 편함이 어디서 오는지 알고 있었다."
  );
}

function showEnding(label, title, text) {
  const endScreen = document.getElementById("ending-screen");
  document.getElementById("ending-label").textContent = label;
  document.getElementById("ending-title").textContent = title;
  document.getElementById("ending-text").textContent = text;
  endScreen.classList.add("show");
}

function restartGame() {
  state.scene = "intro";
  state.choice1 = null;
  state.choice2 = null;
  state.choice3 = null;
  state.choice4 = null;
  state.isPro = false;

  document.getElementById("ending-screen").classList.remove("show");
  document.getElementById("chat-log").innerHTML = "";
  clearChoices();

  // reset header
  document.getElementById("sender-name").textContent = "010-XXXX-XXXX";
  document.getElementById("sender-name").className = "";
  document.getElementById("sender-sub").textContent = "모르는 번호";
  document.getElementById("avatar").textContent = "?";
  document.getElementById("avatar").className = "";

  // show intro
  const intro = document.getElementById("intro-screen");
  intro.classList.remove("hide");
  intro.style.opacity = 1;
  intro.style.pointerEvents = "all";
}
</script>
</body>
</html>
